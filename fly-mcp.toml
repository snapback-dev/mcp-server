app = "snapback-mcp"
primary_region = "sjc"

[build]
builder = "dockerfile"
dockerfile = "apps/mcp-server/Dockerfile"

[build.args]
NODE_ENV = "production"

[env]
NODE_ENV = "production"
LOG_LEVEL = "info"
PORT = "3002"

[[services]]
internal_port = 3002
processes = ["app"]
protocol = "tcp"

[[services.ports]]
port = 80
handlers = ["http"]

[[services.ports]]
port = 443
handlers = ["tls", "http"]

[services.http_checks]
interval = "10s"
timeout = "5s"
grace_period = "40s"
method = "get"
path = "/api/health"
protocol = "http"

[services.tcp_checks]
interval = "10s"
timeout = "5s"
grace_period = "30s"

[[services.concurrency]]
type = "connections"
hard_limit = 500
soft_limit = 400

[http_service]
internal_port = 3002
force_https = true
auto_stop_machines = true
auto_start_machines = true
min_machines_running = 1
processes = ["app"]

[[vm]]
cpu_kind = "shared"
cpus = 1
memory_mb = 256

[env.DATABASE_URL]
inherit = true

[env.BETTER_AUTH_SECRET]
inherit = true

[env.BETTER_AUTH_URL]
inherit = true

[env.NEXT_PUBLIC_SITE_URL]
inherit = true

[env.GOOGLE_CLIENT_ID]
inherit = true

[env.GOOGLE_CLIENT_SECRET]
inherit = true
